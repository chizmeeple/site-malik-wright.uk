{% comment %} Calendar subscription dropdown button Usage: {% include
calendar-subscribe.html %} {% endcomment %} {% assign base_url = site.url |
default: site.config.url | default: '' %} {% assign baseurl = site.baseurl |
default: '' %} {% assign ics_url = base_url | append: baseurl | append:
'/calendar/conventions.ics' %} {% comment %} Convert to webcal:// protocol for
calendar subscription {% endcomment %} {% assign webcal_url = ics_url | replace:
'https://', 'webcal://' | replace: 'http://', 'webcal://' %} {% comment %}
Google Calendar subscription URL {% endcomment %} {% assign google_cal_url =
'https://calendar.google.com/calendar/render?cid=' | append: ics_url %}

<div class="calendar-subscribe-wrapper" style="margin-bottom: 1.5rem">
  <div class="dropdown" style="position: relative; display: inline-block">
    <button
      type="button"
      id="calendarSubscribeBtn"
      aria-haspopup="true"
      aria-expanded="false"
      class="calendar-subscribe-btn"
      onclick="toggleCalendarDropdown()"
    >
      <span style="margin-right: 0.25rem">ðŸ“…</span>
      <span>Subscribe to Calendar</span>
      <span style="margin-left: 0.25rem; font-size: 0.7em; opacity: 0.7"
        >â–¼</span
      >
    </button>
    <div
      id="calendarDropdown"
      class="dropdown-menu"
      style="
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        margin-top: 0.5rem;
        background: var(--body-bg, #fff);
        border: 1px solid var(--border-color, rgba(0, 0, 0, 0.1));
        border-radius: 0.25rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        min-width: 180px;
        z-index: 1000;
        padding: 0.25rem 0;
      "
    >
      <a
        href="{{ google_cal_url }}"
        target="_blank"
        rel="noopener noreferrer"
        class="dropdown-item"
        style="
          display: block;
          padding: 0.5rem 0.75rem;
          color: var(--body-color, #333);
          text-decoration: none;
          transition: background-color 0.15s;
          font-size: 0.9em;
        "
        onmouseover="this.style.backgroundColor='var(--accent-color-highlight, rgba(79,177,186,0.1))'"
        onmouseout="this.style.backgroundColor='transparent'"
      >
        ðŸ“… Google Calendar
      </a>
      <button
        type="button"
        class="dropdown-item"
        onclick="copyFeedUrl('{{ webcal_url }}', this)"
        style="
          display: block;
          width: 100%;
          text-align: left;
          padding: 0.5rem 0.75rem;
          color: var(--body-color, #333);
          text-decoration: none;
          transition: background-color 0.15s;
          font-size: 0.9em;
          background: none;
          border: none;
          cursor: pointer;
          font-family: inherit;
        "
        onmouseover="this.style.backgroundColor='var(--accent-color-highlight, rgba(79,177,186,0.1))'"
        onmouseout="this.style.backgroundColor='transparent'"
      >
        ðŸ“‹ Copy feed URL
      </button>
      <a
        href="{{ ics_url }}"
        download="conventions.ics"
        class="dropdown-item"
        style="
          display: block;
          padding: 0.5rem 0.75rem;
          color: var(--body-color, #333);
          text-decoration: none;
          transition: background-color 0.15s;
          font-size: 0.9em;
        "
        onmouseover="this.style.backgroundColor='var(--accent-color-highlight, rgba(79,177,186,0.1))'"
        onmouseout="this.style.backgroundColor='transparent'"
      >
        ðŸ’¾ Download .ics file
      </a>
    </div>
  </div>
</div>

<script>
  function toggleCalendarDropdown() {
    const dropdown = document.getElementById("calendarDropdown");
    const button = document.getElementById("calendarSubscribeBtn");

    if (dropdown.style.display === "none" || dropdown.style.display === "") {
      dropdown.style.display = "block";
      button.setAttribute("aria-expanded", "true");
    } else {
      dropdown.style.display = "none";
      button.setAttribute("aria-expanded", "false");
    }
  }

  // Close dropdown when clicking outside
  document.addEventListener("click", function (event) {
    const dropdown = document.getElementById("calendarDropdown");
    const button = document.getElementById("calendarSubscribeBtn");

    if (
      dropdown &&
      button &&
      !dropdown.contains(event.target) &&
      !button.contains(event.target)
    ) {
      dropdown.style.display = "none";
      button.setAttribute("aria-expanded", "false");
    }
  });

  // Copy feed URL to clipboard
  function copyFeedUrl(url, button) {
    const originalText = button.innerHTML;

    // Try using the modern Clipboard API
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard
        .writeText(url)
        .then(function () {
          button.innerHTML = "âœ“ Copied!";
          setTimeout(function () {
            button.innerHTML = originalText;
          }, 2000);
        })
        .catch(function (err) {
          // Fallback to older method
          fallbackCopy(url, button, originalText);
        });
    } else {
      // Fallback for older browsers
      fallbackCopy(url, button, originalText);
    }
  }

  // Fallback copy method for older browsers
  function fallbackCopy(url, button, originalText) {
    const textArea = document.createElement("textarea");
    textArea.value = url;
    textArea.style.position = "fixed";
    textArea.style.left = "-999999px";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();

    try {
      const successful = document.execCommand("copy");
      if (successful) {
        button.innerHTML = "âœ“ Copied!";
        setTimeout(function () {
          button.innerHTML = originalText;
        }, 2000);
      } else {
        button.innerHTML = "âš  Copy failed";
        setTimeout(function () {
          button.innerHTML = originalText;
        }, 2000);
      }
    } catch (err) {
      button.innerHTML = "âš  Copy failed";
      setTimeout(function () {
        button.innerHTML = originalText;
      }, 2000);
    }

    document.body.removeChild(textArea);
  }
</script>
